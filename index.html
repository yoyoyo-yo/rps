<html>
    <head>

        <style>
            body{
                text-align:center;
                font-size: 2vw;
            }


            .player-disp{
                height:200px;
                width:50%;
                float:left;
            }

            .divide3{
                width:33%;
                float:left;
            }

            .most-freq-part{
                width:33%;
                float:left;
                position:relative;
            }
            
            .most-freq-part>img{
                position:absolute;
                left: 50%;
                transform: translateY(0%) translateX(-50%);
            }

            .freq-part{
                font-size:20px;
                color:red;
                text-align: center;
                vertical-align: middle;
                margin:auto;
            }
            
            .hand {
                animation: 1s;
                cursor: pointer;
                height: 150px;
            }

            .hand:hover{
                transform: scale(1.2);
            }

            .color-r{
                background-color: red;
            }

            .color-p{
                background-color: rgb(255, 208, 0);
            }

            .color-s{
                background-color: rgb(0, 110, 255);
            }

            .hand-r:hover {
                background-color: red;
            }

            .hand-p:hover {
                background-color: rgb(255, 208, 0);
            }

            .hand-s:hover {
                background-color: rgb(0, 110, 255);
            }

        </style>
    </head>
    <body>
        <h1>Luck or Fate?</h1>

        <div id="play_display" style="display:inline;">

            <p id="game-count-display">X more times</p>

            <div style="height:350px; width:100%;">
                Select your hand<br><br><br><br>
                <img class="hand hand-r" src="images/rock.png" onclick="select_r(); return false;">
                <img class="hand hand-p" src="images/paper.png" onclick="select_p(); return false;">
                <img class="hand hand-s" src="images/scissors.png" onclick="select_s(); return false;">
            </div>

            <div>
                <div class="player-disp">
                    You<br>
                    <img id="player-hand-img" class="hand">
                    <br>
                    <p id="my-select"></p>

                </div>

                <div class="player-disp">
                    Opponent<br>
                    <img id="opponent-hand-img" class="hand">
                    <br>
                    <p id="opponent-select"></p>
                </div>
                <div style="clear:left;"></div>
            </div>

            <p id="result-msg" style="font-size:20px;"></p>

        </div>


        <div id="portfolio" style="display: none;">
            <a href="" onclick="all_clear();">RESET</a>


            <div>
                <p id="result-win">Win : x</p>
                <p id="result-draw">Draw : x</p>
                <p id="result-lose">Lose : x</p>
            </div>

            
            <div style="height:500px;">
                <div id="most-freq">
                    <p id="most-freq-msg">You are easy to put out x </p>
                </div>

                <div class="divide3">
                    <p id="freq-r" class="freq-part">Rock</p>
                </div>
                <div class="divide3">
                    <p id="freq-p" class="freq-part">Paper</p>
                </div>
                <div class="divide3">
                    <p id="freq-s" class="freq-part">Scissors</p>
                </div>

                <div style="clear:left;"></div>

                <div class="most-freq-part" id="freq-r-div">
                    <img id="freq-r-img" src="images/rock.png" height=200>
                </div>
                <div class="most-freq-part" id="freq-p-div">
                    <img id="freq-p-img" src="images/paper.png" height=200>
                </div>
                <div class="most-freq-part" id="freq-s-div">
                    <img id="freq-s-img" src="images/scissors.png" height=200>
                </div>
                <div style="clear:left;"></div>

                <div class="divide3">
                    <a id="r-win-rate">Win : x</a> <br>
                    <a id="r-draw-rate">Draw : x</a> <br>
                    <a id="r-lose-rate">Lose : x</a> <br>
                </div>
                <div class="divide3">
                    <a id="p-win-rate">Win : x</a> <br>
                    <a id="p-draw-rate">Draw : x</a> <br>
                    <a id="p-lose-rate">Lose : x</a> <br>
                </div>
                <div class="divide3">
                    <a id="s-win-rate">Win : x</a> <br>
                    <a id="s-draw-rate">Draw : x</a> <br>
                    <a id="s-lose-rate">Lose : x</a> <br>
                </div>
            </div>

            

            <div style="margin-left:10%; width:80%;">
                <a style="font-size:30px;">Your Markov process</a><br>
                <div style="height:470px; width:40%; float:left;">
                    <a>t - 1</a>
                    <div class="color-r" style="height:150px;">
                        <img src="images/rock.png" height="150">
                    </div>
                    <div style="height: 10px;"></div>
                    <div class="color-p" style="height:150px;">
                        <img src="images/paper.png" height="150">
                    </div>
                    <div style="height: 10px;"></div>
                    <div class="color-s" style="height:150px;">
                        <img src="images/scissors.png" height="150">
                    </div>
                </div>

                <div style="height:470px; width:40%; float:left;">
                    <a>t</a>
                    <div class="color-r" style="height:50px;">
                        <img src="images/rock.png" height="50">
                    </div>
                    <div class="color-p" style="height:50px;">
                        <img src="images/paper.png" height="50">
                    </div>
                    <div class="color-s" style="height:50px;">
                        <img src="images/scissors.png" height="50">
                    </div>

                    <div style="height: 10px;"></div>

                    <div class="color-r" style="height:50px;">
                        <img src="images/rock.png" height="50">
                    </div>
                    <div class="color-p" style="height:50px;">
                        <img src="images/paper.png" height="50">
                    </div>
                    <div class="color-s" style="height:50px;">
                        <img src="images/scissors.png" height="50">
                    </div>

                    <div style="height: 10px;"></div>

                    <div class="color-r" style="height:50px;">
                        <img src="images/rock.png" height="50">
                    </div>
                    <div class="color-p" style="height:50px;">
                        <img src="images/paper.png" height="50">
                    </div>
                    <div class="color-s" style="height:50px;">
                        <img src="images/scissors.png" height="50">
                    </div>

                </div>

                <div style="height:470px; width:20%; float:left;">
                    <a>P(t|t-1)</a>
                    <div style="height:50px;">
                        <a id="freq-r-r">x%</a>
                    </div>
                    <div style="height:50px;">
                        <a id="freq-r-p">y%</a>
                    </div>
                    <div style="height:50px;">
                        <a id="freq-r-s">z%</a>
                    </div>

                    <div style="height:10px;"></div>

                    <div style="height:50px;">
                        <a id="freq-p-r">x%</a>
                    </div>
                    <div style="height:50px;">
                        <a id="freq-p-p">y%</a>
                    </div>
                    <div style="height:50px;">
                        <a id="freq-p-s">z%</a>
                    </div>

                    <div style="height: 10px;"></div>

                    <div style="height:50px;">
                        <a id="freq-s-r">x%</a>
                    </div>
                    <div style="height:50px;">
                        <a id="freq-s-p">y%</a>
                    </div>
                    <div style="height:50px;">
                        <a id="freq-s-s">z%</a>
                    </div>
                </div>
                <div style="float:left;"></div>
            </div>

        </div>

        <div style="clear:left; height:200px;"></div>

        <script type="text/javascript">
            const GAME_MAX_COUNT = 10;

            const IMG_H = 250;
            const IMG_MIN = 40;

            const FONT_SIZE_MAX = 25;
            const FONT_SIZE_MIN = 15;

            const HANDS = ['Rock', 'Paper', 'Scissors'];
            const HANDS_CHAR = ['r', 'p', 's'];
            const HANDS_IMG = ['images/rock.png', 'images/paper.png', 'images/scissors.png'];
            var player_hand = -1
            var opponent_hand = -1;
            var game_result = '';
            var player_hands_counter = [0., 0., 0.];
            var opponent_hands_counter = [0., 0., 0.];
            var player_hands_seq = [];
            var opponent_hands_seq = [];
            var battle_results_seq = [];

            var win_n = 0;
            var lose_n = 0;
            var draw_n = 0;
            var game_count = 0;

            function init(){
                game_count_display_update(GAME_MAX_COUNT - game_count);
            }


            function all_clear(){
                player_hand = -1
                opponent_hand = -1;
                game_result = '';
                player_hands_counter = [0., 0., 0.];
                opponent_hands_counter = [0., 0., 0.];
                player_hands_seq = [];
                opponent_hands_seq = [];
                battle_results_seq = [];

                win_n = 0;
                lose_n = 0;
                draw_n = 0;
                game_count = 0;

                document.getElementById('portfolio').style.display = 'none';
                document.getElementById('play_display').style.display = 'inline';
            }

            function game_count_display_update(x){
                document.getElementById('game-count-display').innerHTML = x + " more times";
            }

            function select_r(){
                game(0);
            }

            function select_p(){
                game(1);
            }

            function select_s(){
                game(2);
            }

            function player_turn(player_hand_i){
                player_hand = player_hand_i;
                document.getElementById('my-select').innerText = HANDS[player_hand_i];
                document.getElementById('player-hand-img').src = HANDS_IMG[player_hand_i];
                player_hands_counter[player_hand_i] ++;
                player_hands_seq.push(player_hand_i);
            }

            function opponent_turn(){
                opponent_tactics_random();
            }

            function opponent_tactics_random(){
                i = Math.floor(Math.random() * 3);
                opponent_hand = i;
                opponent_hands_counter[opponent_hand] ++;
                opponent_hands_seq.push(i);

                document.getElementById('opponent-select').innerText = HANDS[opponent_hand];
                document.getElementById('opponent-hand-img').src = HANDS_IMG[opponent_hand];
            }

            function judge_game(){
                if (player_hand == ((opponent_hand + 1) % 3)){
                    game_result = "WIN ┏( ^o^)┛";
                    win_n ++;
                    battle_results_seq.push(0);
                }
                else if (player_hand == opponent_hand){
                    game_result = "DRAW ( ˙-˙ )";
                    draw_n ++;
                    battle_results_seq.push(1);
                }
                else {
                    game_result = "LOSE (´；ω；｀)";
                    lose_n ++;
                    battle_results_seq.push(2);
                }

                document.getElementById('result-msg').innerText = game_result;
            }

            function game_turn_count(){
                game_count ++;

                if (game_count >= GAME_MAX_COUNT){
                    result_show();
                    analyze_most_freq();
                    analyze_player_hand_result_percentage()
                    analyze_markov2gram();
                    document.getElementById('play_display').style.display = 'none';
                    document.getElementById('portfolio').style.display = 'inline';
                    // all_clear();
                }
            }

            function result_show(){
                document.getElementById('result-win').innerHTML = "Win : " + Math.round(win_n / GAME_MAX_COUNT * 100) + '% (' + + win_n + ' times)';
                document.getElementById('result-draw').innerHTML = "Draw : " + Math.round(draw_n / GAME_MAX_COUNT * 100) + '% (' + + draw_n + ' times)';
                document.getElementById('result-lose').innerHTML = "Lose : " + Math.round(lose_n / GAME_MAX_COUNT * 100) + '% (' + + lose_n + ' times)';
            }

            function analyze_most_freq(){
                let most_freq_hands = [];
                let hand_most_freq = Math.max(...player_hands_counter);
                let player_hands_percent = [];

                for (let i = 0; i < 3; i++){
                    if (player_hands_counter[i] == hand_most_freq){
                        most_freq_hands.push(HANDS[i]);
                    }
                    player_hands_percent.push(player_hands_counter[i] / GAME_MAX_COUNT);
                }

                let result_msg = 'You are easy to put out ' + most_freq_hands.join(', ');
                document.getElementById('most-freq-msg').innerText = result_msg;

                document.getElementById('freq-r').innerText = HANDS[0] + ' ' + Math.round(player_hands_percent[0] * 100) + '%';
                document.getElementById('freq-p').innerText = HANDS[1] + ' ' + Math.round(player_hands_percent[1] * 100) + '%';
                document.getElementById('freq-s').innerText = HANDS[2] + ' ' + Math.round(player_hands_percent[2] * 100) + '%';

                document.getElementById("freq-r-img").style.height = player_hands_percent[0] * IMG_H + IMG_MIN;
                document.getElementById("freq-p-img").style.height = player_hands_percent[1] * IMG_H + IMG_MIN;
                document.getElementById("freq-s-img").style.height = player_hands_percent[2] * IMG_H + IMG_MIN;

                document.getElementById("freq-r-div").style.height = player_hands_percent[0] * IMG_H + IMG_MIN;
                document.getElementById("freq-p-div").style.height = player_hands_percent[1] * IMG_H + IMG_MIN;
                document.getElementById("freq-s-div").style.height = player_hands_percent[2] * IMG_H + IMG_MIN;
            }

            function analyze_player_hand_result_percentage(){
                let hand_most_freq = Math.max(...player_hands_counter);

                let player_hand_results = [[0., 0., 0.], [0., 0., 0.], [0., 0., 0.]];
                let player_hand_counts = [0., 0., 0.];

                let p_i, r_i;
                let id_name;

                for (let i = 0; i < GAME_MAX_COUNT; i++){
                    p_i = player_hands_seq[i];
                    r_i = battle_results_seq[i];

                    player_hand_results[p_i][r_i]++;
                    player_hand_counts[p_i]++;
                }

                // transform count -> percentage
                for (let i = 0; i < 3; i++){
                    if (player_hand_counts[i] == 0){
                        continue;
                    }

                    for (let j = 0; j < 3; j++){
                        player_hand_results[i][j] /= player_hand_counts[i];
                    }
                }

                for (let i = 0; i < 3; i++){
                    document.getElementById(HANDS_CHAR[i] + '-win-rate').innerHTML = 'Win：' + Math.round(player_hand_results[i][0] * 100) + '%';
                    document.getElementById(HANDS_CHAR[i] + '-draw-rate').innerHTML = 'Draw：' + Math.round(player_hand_results[i][1] * 100) + '%';
                    document.getElementById(HANDS_CHAR[i] + '-lose-rate').innerHTML = 'Lose：' + Math.round(player_hand_results[i][2] * 100) + '%';
                }

            }

            function analyze_markov2gram(){
                let player_hands_percent = [[0., 0., 0.], [0., 0., 0.], [0., 0., 0.]];
                let pre_hand = -1, pro_hand = -1;
                let target_id;
                let idtag;
                let x_val;

                for(let i = 0; i < player_hands_seq.length - 1; i++){
                    pre_hand = player_hands_seq[i];
                    pro_hand = player_hands_seq[i + 1];
                    player_hands_percent[pre_hand][pro_hand] ++;
                }

                for(let i = 0; i < 3; i++){
                    for(let j = 0; j < 3; j++){
                        player_hands_percent[i][j] /= (GAME_MAX_COUNT - 1);
                        x_val = player_hands_percent[i][j];

                        target_id = 'freq-' + HANDS_CHAR[i] + '-' + HANDS_CHAR[j];
  
                        idtag = document.getElementById(target_id);
                        idtag.innerText = Math.round(x_val * 100) + '%';
                        idtag.style.fontSize = FONT_SIZE_MAX * x_val + FONT_SIZE_MIN;
                    }
                }

            }

            function game(player_hand_i){
                player_turn(player_hand_i);
                opponent_turn();
                judge_game();

                game_turn_count();
                game_count_display_update(GAME_MAX_COUNT - game_count);
            }


            init();

        </script>
    </body>
</html>